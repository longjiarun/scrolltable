!function(){function t(e,a){function l(){!s(p.$loading)&&r(p.$loading[0])&&p.load()}var p=this;p.options=o.extend({},t.prototype.defaults,a||{}),p.$element=o(e),p.$list=o(a.listSelector),p.$loading=o(a.loadingTemplate).appendTo(p.$element),p.$loading.length&&(p.page=p.options.defaultPage,p.$container=o(n).on(i,l),l())}var e=200,a="scroll",i="scroll resize",n=window,o=n.Zepto||n.jQuery,s=function(t){var a=n.innerHeight+n.scrollY;return a<=o(t).offset().top-e},r=function(t){return!(t.offsetWidth<=0&&t.offsetHeight<=0)};(function(){function t(t,e){var a,i="",n=t.options.template;if(e&&(a=e.length))for(var o=0;a>o;o++)i+=n({data:e[o]});return i}function e(t,e,i){var n=t.data,o=t.$complete;n.splice(e,1),t.$element.find(t.options.itemSelector+i).remove(),0===n.length&&(o&&o.remove(),t.completed&&t.setNoDataStatus()),t.$container.trigger(a)}this.defaults={url:"",type:"get",dataType:"jsonp",listSelector:"ul",itemSelector:".J_scrollTable",loadingTemplate:"",noDataTemplate:"",completedTempalte:"",template:"",success:null,error:null,defaultPage:0,pageSize:10,countKey:"count",resultKey:"result",format:function(t){return t},formatAjaxData:function(t){return t}},this.page=0,this.pages=null,this.data=[],this.getPages=function(t,e){return Math.ceil(t/e)},this.refresh=function(){var t,e;return this.$list.html(""),this.$loading.show(),t&&t.remove(),e&&e.remove(),this.completed=!1,this.page=0,this.pages=null,this.data=[],this.load(),this},this.loaded=!0,this.load=function(){var t=this,e=this.options,i=t.page+1;return t.completed||!t.loaded?t:(t.page=i,t.loaded=!1,null==t.pages||t.page<=t.pages?t.getData({page:t.page,pagesize:e.pageSize},function(i){return t.loaded=!0,i=e.format?e.format(i):i,i[e.countKey]||1!=t.page?(null==t.pages&&(t.pages=t.getPages(i[e.countKey]||0,e.pageSize)),t.append(i[e.resultKey]),void(t.page>=t.pages?t.setCompletedStatus():t.$container.trigger(a))):(t.setNoDataStatus(),t)}):t.setCompletedStatus(),t)},this.setCompletedStatus=function(){var t=this.$nodata;return this.$loading.hide(),t&&t.remove(),this.$complete=o(this.options.completedTempalte).appendTo(this.$element),this.completed=!0,this},this.setNoDataStatus=function(){var t=this.$complete;return this.$loading.hide(),t&&t.remove(),this.$nodata=o(this.options.noDataTemplate).appendTo(this.$element),this.completed=!0,this},this.add=this.append=function(e){var a,i=this.$nodata;return this.data=this.data.concat(e),this.data.length>0&&i&&i.remove(),a=t(this,e),o(a).appendTo(this.$list),this},this.preappend=function(e){var a,i=this.$nodata;return this.data=e.concat(this.data),this.data.length>0&&i&&i.remove(),a=t(this,e),o(a).prependTo(this.$list),this},this.remove=function(t){var a,i=this.data;if(i&&(a=i.length))for(var n=0;a>n;n++)if(i[n]===t)return e(this,n,t.id),this;return this},this.getById=function(t,e){var e=e||"id",a={};return a[e]=t,this.filter(a)[0]},this.removeById=function(t,a){var i,n=this.data,a=a||"id";if(n&&(i=n.length))for(var o=0;i>o;o++)if(n[o][a]==t)return e(this,o,t),this;return this},this.filter=function(t){var e,a=this.data,i=[];if(a&&(e=a.length))for(var n=0;e>n;n++){var o=a[n],s=!0;for(var r in t)if(t[r]!=o[r]){s=!1;break}s&&i.push(o)}return i},this.getData=function(t,e,a){var i=this.options;return o.ajax({url:i.url,type:i.type,dataType:i.dataType,cache:!1,xhrFields:i.xhrFields,contentType:i.contentType,data:i.formatAjaxData?i.formatAjaxData(t):t,success:function(){var t=i.success;t&&t.apply(this,arguments)===!1||e&&e.apply(this,arguments)},error:function(){var t=i.error;t&&t.apply(this,arguments)===!1||a&&a.apply(this,arguments)}}),this}}).call(t.prototype),"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define?define(function(){return t}):n.ScrollTable=t}();