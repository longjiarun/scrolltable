!function(){function t(e,a){function s(){!r(p.$loading)&&l(p.$loading[0])&&p.load()}var p=this;p.options=a=i.extend({},t.prototype.defaults,a||{}),p.$element=i(e),p.$list=i(a.listSelector),p.$loading=i(a.loadingTemplate).appendTo(p.$element),p.$loading.length&&(p.page=p.options.defaultPage,p.$container=i(o).on(n,s),s())}var e=200,a="scroll",n="scroll resize",o=window,i=o.Zepto||o.jQuery,r=function(t){var a=o.innerHeight+o.scrollY;return a<=i(t).offset().top-e},l=function(t){return!(t.offsetWidth<=0&&t.offsetHeight<=0)},s=function(t,e){return Math.ceil(t/e)};(function(){function t(t){var e=t.$nodata;return t.$loading.hide(),e&&e.remove(),t.$complete=i(t.options.completedTempalte).appendTo(t.$element),t.completed=!0,t}function e(t){var e=t.$complete;return t.$loading.hide(),e&&e.remove(),t.$nodata=i(t.options.noDataTemplate).appendTo(t.$element),t.completed=!0,t}function n(t,e){var a,n="",o=t.options.template;if(e&&(a=e.length))for(var i=0;a>i;i++)n+=o({data:e[i]});return n}function o(t,n,o){var i=t.data,r=t.$complete;i.splice(n,1),t.$element.find(t.options.itemSelector+o).remove(),0===i.length&&(r&&r.remove(),t.completed&&e(t)),t.$container.trigger(a)}this.defaults={url:"",type:"get",dataType:"jsonp",listSelector:"ul",itemSelector:".J_scrollTable",loadingTemplate:"",noDataTemplate:"",completedTempalte:"",template:"",success:null,error:null,defaultPage:0,pageSize:10,countKey:"count",resultKey:"result",format:function(t){return t},formatAjaxData:function(t){return t}},this.page=0,this.pages=null,this.data=[],this.refresh=function(){var t,e;return this.$list.html(""),this.$loading.show(),t&&t.remove(),e&&e.remove(),this.completed=!1,this.page=0,this.pages=null,this.data=[],this.load(),this},this.loaded=!0,this.load=function(){var n=this,o=this.options,i=n.page+1;return n.completed||!n.loaded?n:(n.page=i,n.loaded=!1,null==n.pages||n.page<=n.pages?n.getData({page:n.page,pagesize:o.pageSize},function(i){return n.loaded=!0,i=o.format?o.format(i):i,i[o.countKey]||1!=n.page?(null==n.pages&&(n.pages=s(i[o.countKey]||0,o.pageSize)),n.append(i[o.resultKey]),void(n.page>=n.pages?t(n):n.$container.trigger(a))):(e(n),n)}):t(n),n)},this.add=this.append=function(t){var e,a=this.$nodata;return this.data=this.data.concat(t),this.data.length>0&&a&&a.remove(),e=n(this,t),i(e).appendTo(this.$list),this},this.preappend=function(t){var e,a=this.$nodata;return this.data=t.concat(this.data),this.data.length>0&&a&&a.remove(),e=n(this,t),i(e).prependTo(this.$list),this},this.getById=function(t,e){var e=e||"id",a={};return a[e]=t,this.filter(a)[0]},this.removeById=function(t,e){var a,n=this.data,e=e||"id";if(n&&(a=n.length))for(var i=0;a>i;i++)if(n[i][e]==t)return o(this,i,t),this;return this},this.filter=function(t){var e,a=this.data,n=[];if(a&&(e=a.length))for(var o=0;e>o;o++){var i=a[o],r=!0;for(var l in t)if(t[l]!=i[l]){r=!1;break}r&&n.push(i)}return n},this.getData=function(t,e,a){var n=this.options;return i.ajax({url:n.url,type:n.type,dataType:n.dataType,cache:!1,xhrFields:n.xhrFields,contentType:n.contentType,data:n.formatAjaxData?n.formatAjaxData(t):t,success:function(){var t=n.success;t&&t.apply(this,arguments)===!1||e&&e.apply(this,arguments)},error:function(){var t=n.error;t&&t.apply(this,arguments)===!1||a&&a.apply(this,arguments)}}),this}}).call(t.prototype),"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define?define(function(){return t}):o.ScrollTable=t}();